{% extends "layout.html" %}
{% block content %}

<h2 style="margin-top: 20px;">â• åˆ›å»ºæ–°ä»£ç†</h2>
<form method="post" action="/admin/agents" style="display: flex; flex-wrap: wrap; gap: 20px; align-items: center; margin-bottom: 30px;">
    <div>
        <label><strong>User ID:</strong></label><br>
        <input type="text" name="username" required style="padding: 6px; width: 150px;">
    </div>
    <div>
        <label><strong>å¯†ç :</strong></label><br>
        <input type="text" name="password" required style="padding: 6px; width: 150px;">
    </div>
    <div>
        <label><strong>ä½£é‡‘æ–¹æ¡ˆ:</strong></label><br>
        <select name="commission_group" required style="padding: 6px; width: 230px;">
            <option value="A">Ground A (MPTSBWK=26%, HE=19%)</option>
            <option value="B">Ground B (MPTSHEBWK=22%)</option>
        </select>
    </div>
    <div style="align-self: flex-end;">
        <button type="submit" style="padding: 8px 20px; font-size: 15px;">âœ… åˆ›å»ºä»£ç†</button>
    </div>
</form>

<form method="post" action="/admin/process_winning">
    <input type="date" name="date" required>
    <button type="submit">æ‰‹åŠ¨å¤„ç†ä¸­å¥–è®°å½•</button>
</form>

<form method="post" action="/admin/lock_bets" onsubmit="return confirm('ç¡®è®¤è¦é”å®šä»Šæ—¥æ‰€æœ‰æ³¨å•ï¼Ÿ');" style="margin-bottom: 20px;">
    <button type="submit" style="padding: 8px 20px; background-color: #ff8800; color: white; border: none; border-radius: 6px; font-size: 15px;">
        ğŸ”’ æ‰‹åŠ¨é”æ³¨ï¼ˆä»Šæ—¥ï¼‰
    </button>
</form>
<hr>

<h2>ğŸ‘¥ å·²åˆ›å»ºä»£ç†</h2>
<table border="1" cellpadding="10" cellspacing="0" style="width: 100%; border-collapse: collapse; margin-top: 10px;">
    <thead style="background: #f2f2f2;">
        <tr>
            <th style="text-align: left;">User ID</th>
            <th>ä½£é‡‘æ–¹æ¡ˆ</th>
            <th style="text-align: center;">ä¿®æ”¹å¯†ç </th>
            <th style="text-align: center;">æ“ä½œ</th>
        </tr>
    </thead>
    <tbody>
        {% for agent in agents %}
        <tr>
            <td>{{ agent.username }}</td>
            <td>Ground {{ agent.commission_group }}</td>
            <td style="text-align: center;">
                <form method="post" action="/admin/agents/{{ agent.id }}/update_password" style="display: inline-flex; gap: 6px;">
                    <input type="text" name="new_password" placeholder="æ–°å¯†ç " style="padding: 5px;">
                    <button type="submit" style="padding: 6px 12px;">ä¿®æ”¹å¯†ç </button>
                </form>
            </td>
            <td style="text-align: center;">
                <form method="post" action="/admin/agents/{{ agent.id }}/delete" onsubmit="return confirm('ç¡®è®¤åˆ é™¤æ­¤ä»£ç†ï¼Ÿ');" style="display:inline;">
                    <button type="submit" style="padding: 6px 12px; background-color: #dc3545; color: white; border: none; border-radius: 4px;">
                        åˆ é™¤
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<script>
    const params = new URLSearchParams(window.location.search);

    // âœ… åˆ›å»ºä»£ç†
    if (params.get("error") === "missing") {
        alert("â— è¯·å¡«å†™å®Œæ•´ä¿¡æ¯");
    } else if (params.get("error") === "exists") {
        alert("âŒ ç”¨æˆ·åå·²å­˜åœ¨");
    } else if (params.get("success")) {
        const username = params.get("success");
        alert(`âœ… æˆåŠŸåˆ›å»ºä»£ç† ${username}`);
    }

    // âœ… ä¿®æ”¹å¯†ç 
    if (params.get("pw_updated")) {
        const username = params.get("pw_updated");
        alert(`âœ… å·²æ›´æ–° ${username} çš„å¯†ç `);
    } else if (params.get("pw_error")) {
        alert("âŒ å¯†ç æ›´æ–°å¤±è´¥ï¼Œè¯·ç¡®ä¿è¾“å…¥æœ‰æ•ˆ");
    }

    // âœ… åˆ é™¤ä»£ç†
    if (params.get("deleted")) {
        alert(`âœ… æˆåŠŸåˆ é™¤ä»£ç†ï¼š${params.get("deleted")}`);
    } else if (params.get("error") === "notfound") {
        alert("âŒ åˆ é™¤å¤±è´¥ï¼Œä»£ç†ä¸å­˜åœ¨");
    }

    if (params.get("locked") === "1") {
        alert("âœ… å·²æˆåŠŸæ‰§è¡Œä»Šæ—¥é”æ³¨");
    }
    history.replaceState({}, document.title, location.pathname);

</script>
{% endblock %}
